{% assign maxRelated = 5 %}
{% assign minCommonTags =  1 %}
{% assign maxRelatedCounter = 0 %}

{% for post in site.posts %}
  {% assign sameTagCount = 0 %}
  {% for tag in post.tags %}
    {% if post.url != page.url %}
      {% if page.tags contains tag %}
        {% assign sameTagCount = sameTagCount | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
  {% if sameTagCount >= minCommonTags %}
    <div class="post-summary">
      <a href="{{post.url}}">
        <div class="post-summary__top-section">
          <img class="post-summary__banner" src="{{post.banner}}" alt="banner" />
          <p class="post-summary__category">{{post.category}}</p>
          <p class="post-summary__date">{{post.date | date: '%b %d, %Y' }}</p>
        </div>
        <div class="post-summary__bottom-section">
          <div>
            <h2 class="post-summary__title">{{post.title}}</h2>
            <p class="post-summary__extract">{{post.excerpt}}</p>
          </div>
          <div class="post-summary__author-wrapper">
            <span class="post-summary__icon iconify" data-icon="mdi:account-edit" data-inline="false"></span>
            <object><a target="_blank" class="post-summary__author" href="{{post.author_profile}}">{{post.author}}</a></object>
          </div>
        </div>
      </a>
    </div>
    {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
    {% if maxRelatedCounter >= maxRelated %}
      {% break %}
    {% endif %}
  {% endif %}
{% endfor %}