<style>
  .search-wrapper {
    max-width: 80rem;
    margin: var(--search-input-margin-top) auto 0;
    border-radius: 100rem;
    border: 1px solid var(--input-border-color);
    display: flex;
    align-items: center;
    height: 5rem;
    padding: 0.5rem 1rem 0.5rem 1.5rem;
    background-color: var(--input-background-color);
    transition: var(--transition);
    transition-property: color, background-color border-color;
    position: relative;
  }

  .search-wrapper .iconify {
    flex-grow: 0;
    font-size: 2.5rem;
    margin-right: 0.7rem;
  }

  .search-wrapper input {
    flex-grow: 1;
    font-size: 1.8rem;
    border: none;
    outline: none;
    color: var(--input-color);
    background-color: var(--input-background-color);
    transition: var(--transition);
    transition-property: color, background-color;
  }

  .search-wrapper .advanced-search-inputs-wrapper {
    z-index: 30;
    padding: 2rem;
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    width: 100%;
    border-radius: 0.5rem;
    background-color: var(--advanced-search-inputs-background-color);
    box-shadow: var(--box-shadow-01);
  }

  .search-wrapper .advanced-search-inputs-wrapper .section-title-wrapper {
    margin-bottom: 1.8rem;
    display: flex;
    align-items: center;
  }

  .search-wrapper .advanced-search-inputs-wrapper .section-title {
    font-weight: bold;
    font-size: 1.5rem;
    margin-right: 1rem;
  }

  .search-wrapper .advanced-search-inputs-wrapper .iconify {
    font-size: 2rem;
  }

  .search-wrapper .advanced-search-inputs-wrapper .iconify-wrapper {
    display: flex;
  }

  .search-wrapper .advanced-search-inputs-wrapper .iconify-wrapper.hide {
    display: none;
  }

  .search-wrapper .advanced-search-inputs-wrapper .tag {
    margin-right: 0.75rem;
  }

  .search-wrapper .advanced-search-inputs-wrapper .tag:hover {
    color: var(--tag-color);
    background-color: var(--tag-background-color);
  }

  .search-wrapper .advanced-search-inputs-wrapper .tag.selected:hover {
    color: var(--tag-color-on-select);
    background-color: var(--tag-background-color-on-select);
  }
</style>

<div class="search-wrapper">
  <span class="iconify" data-icon="ic:outline-search" data-inline="false"></span>
  <input type="text" placeholder="Search..." />
  <span id="CloseAdvancedSearchIcon" class="hide"
    ><span class="iconify pointer" data-icon="eva:arrow-ios-upward-outline" data-inline="false"></span
  ></span>
  <span id="OpenAdvancedSearchIcon"><span class="iconify pointer" data-icon="eva:arrow-ios-downward-outline" data-inline="false"></span></span>
  <div id="AdvancedSearchInputsWrapper" class="advanced-search-inputs-wrapper hide">
    <div class="section-title-wrapper">
      <p class="section-title">Selected tags</p>
      <span id="UnselectAllTagsIcon" class="iconify-wrapper"
        ><span class="iconify pointer" title="unselect all tags" data-icon="gg:remove-r" data-inline="false"></span
      ></span>
      <span id="SelectAllTagsIcon" class="hide iconify-wrapper">
        <span class="iconify pointer" title="select all tags" data-icon="feather:plus-square" data-inline="false"></span
      ></span>
    </div>
    {% for tag in tags %}
    <span class="tag selected">{{ tag }}</span>
    {% endfor %}
  </div>
</div>

<script>
  const openAdvancedSearchIcon = document.getElementById('OpenAdvancedSearchIcon');
  const closeAdvancedSearchIcon = document.getElementById('CloseAdvancedSearchIcon');
  const selectAllTagsIcon = document.getElementById('SelectAllTagsIcon');
  const unselectAllTagsIcon = document.getElementById('UnselectAllTagsIcon');
  const advancedSearchInputsWrapper = document.getElementById('AdvancedSearchInputsWrapper');
  const tags = document.querySelectorAll('.advanced-search-inputs-wrapper .tag');
  let selectedTags = [];

  selectAllTags();
  openAdvancedSearchIcon.addEventListener('click', handleOpenAdvancedSearchIconClickEvent);
  advancedSearchInputsWrapper.addEventListener('click', handleAdvancedSearchInputsWrapperClickEvent);
  selectAllTagsIcon.addEventListener('click', handleSelectAllTagsIconClickEvent);
  unselectAllTagsIcon.addEventListener('click', handleUnselectAllTagsIconClickEvent);
  document.addEventListener('click', closeAdvancedSearchInputsWrapper);
  tags.forEach((tag) => tag.addEventListener('click', toggleTag));

  function handleOpenAdvancedSearchIconClickEvent(event) {
    event.stopPropagation();
    openAdvancedSearchIcon.classList.add('hide');
    closeAdvancedSearchIcon.classList.remove('hide');
    advancedSearchInputsWrapper.classList.remove('hide');
  }

  function closeAdvancedSearchInputsWrapper() {
    openAdvancedSearchIcon.classList.remove('hide');
    closeAdvancedSearchIcon.classList.add('hide');
    advancedSearchInputsWrapper.classList.add('hide');
  }

  function handleUnselectAllTagsIconClickEvent() {
    unselectAllTagsIcon.classList.add('hide');
    selectAllTagsIcon.classList.remove('hide');
    selectedTags = [];
    tags.forEach((tag) => tag.classList.remove('selected'));
  }

  function handleSelectAllTagsIconClickEvent() {
    selectAllTagsIcon.classList.add('hide');
    unselectAllTagsIcon.classList.remove('hide');
    tags.forEach((tag) => {
      tag.classList.add('selected');
      selectedTags.push(tag.innerText);
    });
  }

  function handleAdvancedSearchInputsWrapperClickEvent(event) {
    event.stopPropagation();
  }

  function toggleTag(event) {
    const tag = event.target;
    const tagValue = event.target.innerText;
    if (selectedTags.includes(tagValue)) {
      selectedTags = selectedTags.filter((t) => t !== tagValue);
      tag.classList.remove('selected');
    } else {
      selectedTags.push(tagValue);
      tag.classList.add('selected');
    }
  }

  function selectAllTags() {
    tags.forEach((tag) => selectedTags.push(tag.innerText));
  }
</script>
